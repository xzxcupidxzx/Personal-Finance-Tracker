<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Qu·∫£n L√Ω T√†i Ch√≠nh C√° Nh√¢n</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <link rel="manifest" href="./manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="T√†i Ch√≠nh">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#3b82f6">
    <meta name="msapplication-navbutton-color" content="#3b82f6">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-touch-fullscreen" content="yes">
    <link rel="apple-touch-icon" href="./LogoFinance.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./LogoFinance.png">
    <link rel="shortcut icon" href="./LogoFinance.png" type="image/png">
    <link rel="apple-touch-icon" href="./LogoFinance.png">
    <link rel="apple-touch-icon" sizes="57x57" href="./LogoFinance.png">
    <link rel="apple-touch-icon" sizes="60x60" href="./LogoFinance.png">
    <link rel="apple-touch-icon" sizes="72x72" href="./LogoFinance.png">
    <link rel="apple-touch-icon" sizes="76x76" href="./LogoFinance.png">
    <link rel="apple-touch-icon" sizes="114x114" href="./LogoFinance.png">
    <link rel="apple-touch-icon" sizes="120x120" href="./LogoFinance.png">
    <link rel="apple-touch-icon" sizes="144x144" href="./LogoFinance.png">
    <link rel="apple-touch-icon" sizes="152x152" href="./LogoFinance.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./LogoFinance.png">
    <link rel="icon" type="image/png" sizes="512x512" href="./LogoFinance.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./LogoFinance.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./LogoFinance.png">
    <link rel="shortcut icon" href="./LogoFinance.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="./styles.css">

    <style>
        @supports (-webkit-touch-callout: none) {
            body {
                -webkit-text-size-adjust: 100%;
                -webkit-touch-callout: none;
            }
            input, textarea, select {
                -webkit-user-select: text !important;
                user-select: text !important;
                -webkit-touch-callout: default !important;
            }
        }
    </style>
</head>
<body class="font-sans antialiased">

    <header class="app-header">
        <div class="header-content">
            <h1 class="header-title">
                <span class="header-icon">üí∞</span>
                Qu·∫£n L√Ω T√†i Ch√≠nh
            </h1>
			<button id="toggle-summary-visibility" class="eye-toggle-btn header-eye" title="·∫®n/hi·ªán s·ªë d∆∞">
				</button>
            <div class="header-summary">
				<div class="summary-card income">
					<div class="summary-label-container">
						<span class="summary-label">Thu nh·∫≠p th√°ng</span>
					</div>
					<span class="summary-value" id="header-income">0 ‚Ç´</span>
				</div>
                <div class="summary-card expense">
                    <span class="summary-label">Chi ti√™u th√°ng</span>
                    <span class="summary-value" id="header-expense">0 ‚Ç´</span>
                </div>
                <div class="summary-card balance">
                    <span class="summary-label">S·ªë d∆∞</span>
                    <span class="summary-value" id="header-balance">0 ‚Ç´</span>
                </div>
            </div>
        </div>
    </header>
    <div id="message-box" class="message-box" style="display: none;"></div>

    <main class="main-container">
        <div class="tab-content-container">
            <section id="tab-transactions" class="tab-content active">
                <div class="quick-add-section">
                    <h2 class="section-title"><span class="section-icon">‚úèÔ∏è</span>Th√™m Giao D·ªãch Nhanh</h2>
                    <form id="transaction-form" class="transaction-form" novalidate>
                        <div class="form-row">
                            <label class="form-label">Lo·∫°i giao d·ªãch</label>
                            <div class="radio-group">
                                <label class="radio-option income-option">
                                    <input type="radio" name="type" value="Thu" required>
                                    <span class="radio-custom"></span>
                                    <span class="radio-text">Thu nh·∫≠p</span>
                                </label>
                                <label class="radio-option expense-option">
                                    <input type="radio" name="type" value="Chi" checked required>
                                    <span class="radio-custom"></span>
                                    <span class="radio-text">Chi ti√™u</span>
                                </label>
                                <label class="radio-option transfer-option">
                                    <input type="radio" name="type" value="Transfer" required>
                                    <span class="radio-custom"></span>
                                    <span class="radio-text">Chuy·ªÉn ti·ªÅn</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-row">
                            <label for="amount-input" class="form-label">S·ªë ti·ªÅn</label>
                            <div class="amount-input-group flex items-center bg-[var(--bg-tertiary)] rounded-2xl border border-[var(--border-color)] px-4 py-3 mt-1" style="min-height:58px;">
                                <input type="text"
                                    id="amount-input"
                                    class="amount-input flex-1 bg-transparent outline-none border-0 text-xl text-[var(--text-primary)] px-1"
                                    placeholder="Nh·∫≠p s·ªë ti·ªÅn"
                                    inputmode="decimal"
                                    autocomplete="off"
                                    autocorrect="off"
                                    autocapitalize="off"
                                    spellcheck="false"
                                    required
                                    data-virtual-keyboard="true"
                                    data-format-currency="true">
                                <select id="currency-selector" class="currency-selector bg-[var(--bg-secondary)] text-[var(--text-primary)] rounded-xl px-3 py-2 border border-[var(--border-color)]">
                                    <option value="VND">VNƒê</option>
                                    <option value="USD">USD</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row" id="category-row">
                            <label for="category-select" class="form-label">H·∫°ng m·ª•c</label>
                            <select id="category-select" class="form-select" required>
                                <option value="">Ch·ªçn h·∫°ng m·ª•c...</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <label for="account-from" class="form-label" id="account-from-label">T√†i kho·∫£n</label>
                            <select id="account-from" class="form-select" required>
                                <option value="">Ch·ªçn t√†i kho·∫£n...</option>
                            </select>
                        </div>
                        <div class="form-row" id="to-account-row" style="display: none;">
                            <label for="account-to" class="form-label">ƒê·∫øn t√†i kho·∫£n</label>
                            <select id="account-to" class="form-select">
                                <option value="">Ch·ªçn t√†i kho·∫£n nh·∫≠n...</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <label for="description-input" class="form-label">M√¥ t·∫£</label>
                            <input type="text"
                                id="description-input"
                                class="form-input"
                                placeholder="M√¥ t·∫£ giao d·ªãch (t√πy ch·ªçn)"
                                autocomplete="off"
                                autocorrect="on"
                                autocapitalize="sentences"
                                list="description-suggestions">
                            <datalist id="description-suggestions"></datalist>
                        </div>
                        <div class="form-row">
                            <label for="datetime-input" class="form-label">Ng√†y & Gi·ªù</label>
                            <input type="datetime-local"
                                id="datetime-input"
                                class="form-input"
                                autocomplete="off"
                                required>
                        </div>
                        <div id="suggestion-area" class="suggestion-area" style="display: none;">
                            <div class="suggestion-content">
                                <span class="suggestion-text">
                                    G·ª£i √Ω: <strong id="suggestion-desc"></strong> - <strong id="suggestion-amount"></strong>
                                </span>
                                <div class="suggestion-actions">
                                    <button type="button" id="apply-suggestion" class="btn-suggestion apply">√Åp d·ª•ng</button>
                                    <button type="button" id="dismiss-suggestion" class="btn-suggestion dismiss">B·ªè qua</button>
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="submit-btn" id="submit-btn">
                            <span class="btn-icon">‚ûï</span>
                            <span class="btn-text">Th√™m Giao D·ªãch</span>
                        </button>
                        <div class="smart-reset-option" style="margin-top: 1rem; padding: 0.75rem; background: var(--bg-tertiary); border-radius: 12px; border: 1px solid var(--border-color); transition: all 0.2s ease;">
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" id="smart-reset-enabled" checked style="accent-color: var(--primary-color); width: 18px; height: 18px;">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2">
                                        <span class="text-sm font-medium text-[var(--text-primary)]">üéØ Gi·ªØ h·∫°ng m·ª•c & t√†i kho·∫£n sau khi th√™m</span>
                                        <span class="text-xs text-[var(--text-muted)] cursor-help" title="Khi b·∫≠t, ch·ªâ reset s·ªë ti·ªÅn v√† m√¥ t·∫£ sau khi th√™m giao d·ªãch th√†nh c√¥ng">‚ÑπÔ∏è</span>
                                    </div>
                                    <p class="text-xs text-[var(--text-muted)] mt-1">
                                        Ti·ªán l·ª£i khi th√™m nhi·ªÅu giao d·ªãch c√πng lo·∫°i li√™n ti·∫øp
                                    </p>
                                </div>
                            </label>
                        </div>
                    </form>
                </div>
                <div class="transaction-list-section">
						<div class="section-header">
							<h2 class="section-title"><span class="section-icon">üìã</span>Giao D·ªãch G·∫ßn ƒê√¢y</h2>
							<div class="filter-controls">
								<select id="filter-period" class="filter-select">
									<option value="today">H√¥m nay</option>
									<option value="week">Tu·∫ßn n√†y</option>
									<option value="month" selected>Th√°ng n√†y</option>
									<option value="all">T·∫•t c·∫£</option>
									<option value="custom">T√πy ch·ªânh...</option>
								</select>
								
								<div id="custom-date-picker-container" style="display: none;">
									<div class="date-input-group">
										<label for="filter-start-date">T·ª´:</label>
										<input type="date" id="filter-start-date" class="filter-date">
									</div>
									<div class="date-input-group">
										<label for="filter-end-date">ƒê·∫øn:</label>
										<input type="date" id="filter-end-date" class="filter-date">
									</div>
									<button id="filter-apply-button" class="filter-apply-button">√Åp d·ª•ng</button>
								</div>
							</div>
						</div>
					</div>
                    <div class="transaction-list" id="transaction-list"></div>
                    <div id="no-transactions" class="no-data" style="display: none;">
                    </div>
                </div>
            </section>

            <section id="tab-history" class="tab-content">
				<div class="transaction-calendar-section">
					<h3 class="subsection-title">üìÖ L·ªãch Giao D·ªãch</h3>
					
					<div class="calendar-container">
						<div class="calendar-header">
							<div class="month-navigation">
								<button class="nav-btn" id="prev-month-btn">‚Äπ</button>
								<div class="current-month" id="current-month-display">Th√°ng n√†y</div>
								<button class="nav-btn" id="next-month-btn">‚Ä∫</button>
							</div>
							
							<div class="month-summary-cards">
								<div class="summary-card income">
									<div class="summary-label">T·ªïng thu nh·∫≠p</div>
									<div class="summary-value" id="calendar-total-income">0 ‚Ç´</div>
								</div>
								<div class="summary-card expense">
									<div class="summary-label">T·ªïng ƒë√£ chi</div>
									<div class="summary-value" id="calendar-total-expense">0 ‚Ç´</div>
								</div>
							</div>
						</div>
						
						<div class="calendar-grid">
							<div class="calendar-weekdays">
								<div class="weekday">T2</div>
								<div class="weekday">T3</div>
								<div class="weekday">T4</div>
								<div class="weekday">T5</div>
								<div class="weekday">T6</div>
								<div class="weekday">T7</div>
								<div class="weekday">CN</div>
							</div>
							
							<div class="calendar-days-grid" id="calendar-days-grid">
								</div>
						</div>
					</div>
				</div>

				<div id="day-detail-modal" class="modal" style="display: none;">
					<div class="modal-content">
						<div class="modal-header">
							<h3 id="modal-day-title">Giao d·ªãch ng√†y</h3>
							<button class="modal-close" id="close-day-modal">&times;</button>
						</div>
						<div class="modal-body" id="modal-day-transactions">
							</div>
					</div>
				</div>
				<div class="tab-header">
                    <h2 class="tab-title">
                        <span class="tab-icon">üè¶</span>
                        L·ªãch S·ª≠ & ƒê·ªëi So√°t
                    </h2>
                </div>

                <div class="account-balances-section">
                    <h3 class="subsection-title">S·ªë D∆∞ T√†i Kho·∫£n</h3>
                    <div class="account-balance-grid" id="account-balance-grid">
                        </div>
                </div>

                <div class="reconciliation-section">
                    <h3 class="subsection-title">ƒê·ªëi So√°t T√†i Kho·∫£n</h3>
                    <div class="reconciliation-container">
                        <div class="reconciliation-scroll">
                            <table class="reconciliation-table" id="reconciliation-table">
                                <thead>
                                    <tr>
                                        <th class="sticky-col">M·ª•c / T√†i kho·∫£n</th>
                                        </tr>
                                </thead>
                                <tbody>
                                    </tbody>
                            </table>
                        </div>
                        <div class="scroll-hint">‚Üê Vu·ªët ngang ƒë·ªÉ xem th√™m c·ªôt ‚Üí</div>
                    </div>
                </div>

				<div class="reconciliation-history-section">
					<div class="section-header">
						<h3 class="subsection-title" style="margin-bottom: 0;">L·ªãch S·ª≠ ƒê·ªëi So√°t</h3>
						<div class="filter-controls">
							<select id="reconciliation-history-filter-period" class="filter-select">
								<option value="all">T·∫•t c·∫£</option>
								<option value="this_month" selected>Th√°ng n√†y</option>
								<option value="last_month">Th√°ng tr∆∞·ªõc</option>
								<option value="this_year">NƒÉm n√†y</option>
								<option value="custom">T√πy ch·ªânh...</option>
							</select>
						</div>
					</div>

					<div id="reconciliation-history-custom-dates" style="display: none; margin-top: 1rem;">
						<div class="custom-date-picker-container">
							<div class="date-input-group">
								<label for="reconciliation-filter-start-date">T·ª´:</label>
								<input type="date" id="reconciliation-filter-start-date" class="filter-date">
							</div>
							<div class="date-input-group">
								<label for="reconciliation-filter-end-date">ƒê·∫øn:</label>
								<input type="date" id="reconciliation-filter-end-date" class="filter-date">
							</div>
							<button id="reconciliation-filter-apply-button" class="filter-apply-button">√Åp d·ª•ng</button>
						</div>
					</div>

					<div class="reconciliation-history" id="reconciliation-history">
						</div>
				</div>
            </section>

            <section id="tab-statistics" class="tab-content">
				<div class="tab-header">
					<h2 class="tab-title">
						<span class="tab-icon">üìä</span>
						Th·ªëng K√™ & Bi·ªÉu ƒê·ªì
					</h2>
					<div class="filter-controls">
						<select id="stats-period" class="filter-select">
							<option value="week">Tu·∫ßn n√†y</option>
							<option value="month" selected>Th√°ng n√†y</option>
							<option value="quarter">Qu√Ω n√†y</option>
							<option value="year">NƒÉm n√†y</option>
							<option value="custom">T√πy ch·ªânh</option>
						</select>
					</div>
				</div>
				<div class="stats-summary">
					<div class="stats-card income-card">
                        <span class="stats-icon"><i class="fa-solid fa-arrow-down"></i></span>
						<div>
                            <span class="stats-label">T·ªïng thu nh·∫≠p</span>
                            <span class="stats-value" id="stats-total-income">0 ‚Ç´</span>
                        </div>
						<span class="stats-change" id="stats-income-change"></span>
					</div>
					<div class="stats-card expense-card">
                        <span class="stats-icon"><i class="fa-solid fa-arrow-up"></i></span>
						<div>
						    <span class="stats-label">T·ªïng chi ti√™u</span>
						    <span class="stats-value" id="stats-total-expense">0 ‚Ç´</span>
                        </div>
						<span class="stats-change" id="stats-expense-change"></span>
					</div>
					<div class="stats-card balance-card">
                        <span class="stats-icon"><i class="fa-solid fa-scale-balanced"></i></span>
						<div>
						    <span class="stats-label">S·ªë d∆∞ r√≤ng</span>
						    <span class="stats-value" id="stats-net-balance">0 ‚Ç´</span>
                        </div>
						<span class="stats-change" id="stats-balance-change"></span>
					</div>
				</div>

				
                <div class="chart-section">
                    <div class="chart-header">
                        <h3 class="chart-title">Chi Ti√™u Theo Danh M·ª•c</h3>
                        <div class="chart-controls">
                            <select id="chart-type" class="chart-type-selector">
                                <option value="doughnut">Bi·ªÉu ƒë·ªì tr√≤n</option>
                                <option value="bar">Bi·ªÉu ƒë·ªì c·ªôt</option>
                            </select>
                            <button id="export-expense-chart" class="action-btn-small export-btn" title="Xu·∫•t bi·ªÉu ƒë·ªì">üñºÔ∏è</button>
                        </div>
                    </div>
                    <div class="chart-container-wrapper">
                        <div class="chart-container" id="expense-chart-container" style="min-height: 300px;"> <canvas id="expense-chart"></canvas>
                        </div>
                        <div class="chart-legend" id="expense-legend">
                            </div>
                    </div>
                </div>

                <div class="chart-section">
                    <div class="chart-header">
                        <h3 class="chart-title">Lu·ªìng Ti·ªÅn (Thu Nh·∫≠p vs Chi Ti√™u H√†ng Th√°ng)</h3>
                        </div>
                    <div id="monthly-cashflow-container" class="chart-container" style="min-height: 200px; display: flex; align-items: center; justify-content: center;">
                        </div>
                </div>
                <div class="trend-section chart-section"> <div class="chart-header"> <h3 class="subsection-title chart-title">Xu H∆∞·ªõng 7 Ng√†y Qua</h3>
                         <button id="export-trend-chart" class="action-btn-small export-btn" title="Xu·∫•t bi·ªÉu ƒë·ªì">üñºÔ∏è</button>
                    </div>
                    <div class="trend-chart-container chart-container" id="trend-chart-container" style="min-height: 250px;"> <canvas id="trend-chart"></canvas>
                    </div>
                </div>

                <div class="comparison-section chart-section"> <div class="chart-header"> <h3 class="subsection-title chart-title">So S√°nh Th√°ng (Thu Nh·∫≠p & Chi Ti√™u)</h3>
                        <button id="export-comparison-chart" class="action-btn-small export-btn" title="Xu·∫•t bi·ªÉu ƒë·ªì">üñºÔ∏è</button>
                    </div>
                    <div class="comparison-chart-container chart-container" id="comparison-chart-container" style="min-height: 250px;"> <canvas id="comparison-chart"></canvas>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="settings-section-title subsection-title">
                        <span class="settings-icon">üéØ</span>
                        Theo D√µi Ng√¢n S√°ch
                    </h3>
                    <div id="budget-tracking-container" class="budget-progress-grid" style="min-height: 100px; display: flex; align-items: center; justify-content: center;">
                        </div>
                </div>
            </section>

            <section id="tab-categories" class="tab-content">
                <div class="tab-header">
                    <h2 class="tab-title">
                        <span class="tab-icon">üè∑Ô∏è</span>
                        Qu·∫£n L√Ω Danh M·ª•c
                    </h2>
                </div>

                <div class="category-section">
                    <h3 class="category-section-title">
                        <span class="category-icon income">üí∞</span>
                        Danh M·ª•c Thu Nh·∫≠p
                    </h3>

                    <div class="add-category-form">
                        <div class="form-group">
                            <input type="text"
                                   id="new-income-category"
                                   class="category-input"
                                   placeholder="T√™n danh m·ª•c thu nh·∫≠p m·ªõi"
                                   autocomplete="off"
                                   autocorrect="on"
                                   autocapitalize="words">
                            <button id="add-income-category" class="add-category-btn">
                                <span class="btn-icon">‚ûï</span>
                                Th√™m
                            </button>
                        </div>
                        <div id="new-income-category-error" class="input-error-message" style="display: none;"></div>
                    </div>

                    <div class="category-list">
                        <ul id="income-category-list" class="category-items">
                            </ul>
                    </div>
                </div>

                <div class="category-section">
                    <h3 class="category-section-title">
                        <span class="category-icon expense">üí∏</span>
                        Danh M·ª•c Chi Ti√™u
                    </h3>

                    <div class="add-category-form">
                        <div class="form-group">
                            <input type="text"
                                   id="new-expense-category"
                                   class="category-input"
                                   placeholder="T√™n danh m·ª•c chi ti√™u m·ªõi"
                                   autocomplete="off"
                                   autocorrect="on"
                                   autocapitalize="words">
                            <button id="add-expense-category" class="add-category-btn">
                                <span class="btn-icon">‚ûï</span>
                                Th√™m
                            </button>
                        </div>
                        <div id="new-expense-category-error" class="input-error-message" style="display: none;"></div>
                    </div>

                    <div class="category-list">
                        <ul id="expense-category-list" class="category-items">
                            </ul>
                    </div>
                </div>

                <div class="category-section">
                    <h3 class="category-section-title">
                        <span class="category-icon account">üè¶</span>
                        T√†i Kho·∫£n
                    </h3>

                    <div class="add-category-form">
                        <div class="form-group">
                            <input type="text"
                                   id="new-account"
                                   class="category-input"
                                   placeholder="T√™n t√†i kho·∫£n m·ªõi"
                                   autocomplete="off"
                                   autocorrect="on"
                                   autocapitalize="words">
                            <button id="add-account" class="add-category-btn">
                                <span class="btn-icon">‚ûï</span>
                                Th√™m
                            </button>
                        </div>
                        <div id="new-account-error" class="input-error-message" style="display: none;"></div>
                    </div>

                    <div class="category-list">
                        <ul id="account-list" class="category-items">
                            </ul>
                    </div>
                </div>
            </section>

            <section id="tab-settings" class="tab-content">
                <div class="tab-header">
                    <h2 class="tab-title">
                        <span class="tab-icon">‚öôÔ∏è</span>
                        C√†i ƒê·∫∑t & Backup
                    </h2>
                </div>

                <div class="settings-section">
                    <h3 class="settings-section-title">
                        <span class="settings-icon">üé®</span>
                        Giao Di·ªán
                    </h3>

					<div class="update-controls">
						<div class="info-item">
							<span class="info-label">Phi√™n b·∫£n hi·ªán t·∫°i</span>
							<span class="info-value" id="current-app-version">1.0.3</span>
						</div>

						<div class="info-item">
							<span class="info-label">Tr·∫°ng th√°i c·∫≠p nh·∫≠t</span>
							<span class="info-value" id="update-status">ƒêang ki·ªÉm tra...</span>
						</div>

						<div class="info-item">
							<span class="info-label">L·∫ßn ki·ªÉm tra cu·ªëi</span>
							<span class="info-value" id="last-update-check">Ch∆∞a ki·ªÉm tra</span>
						</div>

						<div class="update-actions">
							<button id="check-updates" class="action-btn import">
								<span class="btn-icon">üîç</span>
								<div class="btn-content">
									<span class="btn-title">Ki·ªÉm Tra C·∫≠p Nh·∫≠t</span>
									<span class="btn-subtitle">T√¨m phi√™n b·∫£n m·ªõi</span>
								</div>
							</button>

							<button id="force-refresh-app" class="action-btn export">
								<span class="btn-icon">üîÑ</span>
								<div class="btn-content">
									<span class="btn-title">L√†m M·ªõi ·ª®ng D·ª•ng</span>
									<span class="btn-subtitle">T·∫£i l·∫°i ho√†n to√†n t·ª´ server</span>
								</div>
							</button>

							<button id="clear-app-cache" class="action-btn danger" style="display: none;">
								<span class="btn-icon">üóëÔ∏è</span>
								<div class="btn-content">
									<span class="btn-title">X√≥a Cache ·ª®ng D·ª•ng</span>
									<span class="btn-subtitle">Ch·ªâ d√πng khi c√≥ l·ªói</span>
								</div>
							</button>
						</div>

						<div class="update-help" style="
							background: var(--bg-tertiary);
							border-radius: 8px;
							padding: 1rem;
							margin-top: 1rem;
							border-left: 4px solid var(--primary-color);
						">
							<div style="font-size: 0.9rem; color: var(--text-secondary); line-height: 1.5;">
								<strong>üí° H∆∞·ªõng d·∫´n c·∫≠p nh·∫≠t:</strong><br>
								‚Ä¢ <strong>Ki·ªÉm tra c·∫≠p nh·∫≠t:</strong> T√¨m phi√™n b·∫£n m·ªõi t·ª´ server<br>
								‚Ä¢ <strong>L√†m m·ªõi ·ª©ng d·ª•ng:</strong> T·∫£i l·∫°i to√†n b·ªô t·ª´ server (khuy·∫øn ngh·ªã)<br>
								‚Ä¢ <strong>Tr√™n iOS:</strong> N·∫øu ·ª©ng d·ª•ng kh√¥ng c·∫≠p nh·∫≠t, h√£y ƒë√≥ng ho√†n to√†n app v√† m·ªü l·∫°i
							</div>
						</div>
					</div>
				</div>
				<div class="theme-options">
				  <label class="theme-option">
					<input type="radio" name="theme" value="light" checked>
					<span class="theme-preview">üåû</span>
					<span class="theme-label">S√°ng</span>
				  </label>
				  <label class="theme-option">
					<input type="radio" name="theme" value="dark">
					<span class="theme-preview">üåô</span>
					<span class="theme-label">T·ªëi</span>
				  </label>
				  <label class="theme-option">
					<input type="radio" name="theme" value="auto">
					<span class="theme-preview">üîÑ</span>
					<span class="theme-label">T·ª± ƒë·ªông</span>
				  </label>
				</div>
                <div class="settings-section">
                    <h3 class="settings-section-title">
                        <span class="settings-icon">üíæ</span>
                        Qu·∫£n L√Ω D·ªØ Li·ªáu
                    </h3>

					<div class="data-actions">
						<button id="export-json" class="action-btn export">
							<span class="btn-icon">üì•</span>
							<div class="btn-content">
								<span class="btn-title">Xu·∫•t JSON</span>
								<span class="btn-subtitle">Backup to√†n b·ªô d·ªØ li·ªáu</span>
							</div>
						</button>

						<button id="export-csv" class="action-btn export">
							<span class="btn-icon">üìÑ</span>
							<div class="btn-content">
								<span class="btn-title">Xu·∫•t CSV</span>
								<span class="btn-subtitle">D·ªØ li·ªáu giao d·ªãch</span>
							</div>
						</button>

						<button id="import-data" class="action-btn import">
							<span class="btn-icon">üì§</span>
							<div class="btn-content">
								<span class="btn-title">Nh·∫≠p D·ªØ Li·ªáu (JSON)</span>
								<span class="btn-subtitle">Kh√¥i ph·ª•c t·ª´ file JSON backup</span>
							</div>
						</button>
						
						<button id="import-csv-btn" class="action-btn import">
							<span class="btn-icon">üìÑ</span>
							<div class="btn-content">
								<span class="btn-title">Nh·∫≠p t·ª´ CSV</span>
								<span class="btn-subtitle">Th√™m h√†ng lo·∫°t giao d·ªãch t·ª´ file CSV</span>
							</div>
						</button>
						<input type="file" id="import-file" accept=".json,application/json" style="display: none;">
						<input type="file" id="import-csv-file" accept=".csv,text/csv" style="display: none;">
					</div>
                </div>

                <div class="settings-section">
                    <h3 class="settings-section-title">
                        <span class="settings-icon">üí±</span>
                        Ti·ªÅn T·ªá
                    </h3>

                    <div class="currency-settings">
                        <div class="setting-item">
                            <label class="setting-label">T·ª∑ gi√° USD/VNƒê</label>
                            <input type="tel"
                                   id="usd-rate"
                                   class="setting-input"
                                   value="25000"
                                   min="1000"
                                   max="50000"
                                   inputmode="numeric"
                                   pattern="[0-9]*"
                                   autocomplete="off">
                            <div id="usd-rate-error" class="input-error-message" style="display: none;"></div>
                        </div>

                        <div class="setting-item">
                            <label class="setting-label">Ti·ªÅn t·ªá m·∫∑c ƒë·ªãnh</label>
                            <select id="default-currency" class="setting-select">
                                <option value="VND">Vi·ªát Nam ƒê·ªìng (‚Ç´)</option>
                                <option value="USD">US Dollar ($)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="settings-section-title">
                        <span class="settings-icon">‚ÑπÔ∏è</span>
                        Th√¥ng Tin ·ª®ng D·ª•ng
                    </h3>

                    <div class="app-info">
                        <div class="info-item">
							<span class="info-label">Phi√™n b·∫£n</span>
							<span class="info-value" id="app-info-version">N/A</span>
                        </div>

                        <div class="info-item">
                            <span class="info-label">T·ªïng giao d·ªãch</span>
                            <span class="info-value" id="total-transactions">0</span>
                        </div>

                        <div class="info-item">
                            <span class="info-label">Dung l∆∞·ª£ng d·ªØ li·ªáu</span>
                            <span class="info-value" id="data-size">0 KB</span>
                        </div>

                        <div class="info-item">
                            <span class="info-label">L·∫ßn backup cu·ªëi</span>
                            <span class="info-value" id="last-backup">Ch∆∞a backup</span>
                        </div>
                    </div>
                </div>

                <div class="settings-section danger-section">
                    <h3 class="settings-section-title">
                        <span class="settings-icon">‚ö†Ô∏è</span>
                        V√πng Nguy Hi·ªÉm
                    </h3>

                    <div class="danger-actions">
                        <button id="clear-data" class="action-btn danger">
                            <span class="btn-icon">üóëÔ∏è</span>
                            <div class="btn-content">
                                <span class="btn-title">X√≥a To√†n B·ªô D·ªØ Li·ªáu</span>
                                <span class="btn-subtitle">Kh√¥ng th·ªÉ kh√¥i ph·ª•c</span>
                            </div>
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <nav class="bottom-nav">
        <button class="nav-item active" data-tab="transactions">
            <span class="nav-icon"><i class="fa-solid fa-credit-card"></i></span>
            <span class="nav-label">Giao D·ªãch</span>
        </button>

        <button class="nav-item" data-tab="history">
            <span class="nav-icon"><i class="fa-solid fa-calendar-days"></i></span>
            <span class="nav-label">L·ªãch S·ª≠</span>
        </button>

        <button class="nav-item" data-tab="statistics">
            <span class="nav-icon"><i class="fa-solid fa-chart-pie"></i></span>
            <span class="nav-label">Th·ªëng K√™</span>
        </button>

        <button class="nav-item" data-tab="categories">
            <span class="nav-icon"><i class="fa-solid fa-tags"></i></span>
            <span class="nav-label">Danh M·ª•c</span>
        </button>

        <button class="nav-item" data-tab="settings">
            <span class="nav-icon"><i class="fa-solid fa-gear"></i></span>
            <span class="nav-label">C√†i ƒê·∫∑t</span>
        </button>
    </nav>

    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <span class="loading-text">ƒêang t·∫£i...</span>
        </div>
    </div>
	<div id="virtualNumericKeyboard" class="virtual-keyboard">
	  <div class="virtual-keyboard-row">
		<button data-key="1">1</button>
		<button data-key="2">2</button>
		<button data-key="3">3</button>
	  </div>
	  <div class="virtual-keyboard-row">
		<button data-key="4">4</button>
		<button data-key="5">5</button>
		<button data-key="6">6</button>
	  </div>
	  <div class="virtual-keyboard-row">
		<button data-key="7">7</button>
		<button data-key="8">8</button>
		<button data-key="9">9</button>
	  </div>
	  <div class="virtual-keyboard-row">
		<button data-key="000">000</button>
		<button data-key="0">0</button>
		<button data-key="backspace">‚Üê</button>
	  </div>
	  <div class="virtual-keyboard-row">
		<button data-key="done">Done</button>
	  </div>
	</div>
	<div id="edit-item-modal" class="modal" style="display: none;">
		<div class="modal-content">
			<div class="modal-header">
				<h3 id="edit-item-modal-title">Ch·ªânh s·ª≠a</h3>
				<button id="close-edit-item-modal" class="modal-close">&times;</button>
			</div>
			<div class="modal-body">
				<div class="form-row-wrapper">

					<div class="form-row">
						<label for="edit-item-name" class="form-label">T√™n m·ªõi</label>
						<input type="text" id="edit-item-name" class="form-input" placeholder="Nh·∫≠p t√™n m·ªõi">
					</div>

					<div class="form-row">
						<label class="form-label">Icon</label>
						<div class="current-icon-preview-container">
							<span id="current-item-icon-display" class="category-icon"></span>
							<span id="current-item-icon-label" class="current-icon-label"></span>
						</div>
					</div>

				</div>
				<hr class="form-divider">

				<div class="picker-controls">
					<div class="search-container">
						<i class="fa-solid fa-magnifying-glass search-icon"></i>
						<input type="text" id="icon-picker-search" class="icon-search-input" placeholder="T√¨m ki·∫øm icon...">
					</div>
					<label for="icon-upload-input" class="action-btn-icon-only" title="T·∫£i l√™n icon c·ªßa b·∫°n">
						<i class="fa-solid fa-upload"></i>
					</label>
					<input id="icon-upload-input" type="file" accept="image/*" style="display: none;" />
				</div>
				
				<div id="icon-picker-grid" class="icon-picker-grid-scrollable">
				</div>
			</div>
			<div class="modal-footer">
				<button id="save-item-changes-btn" class="submit-btn compact">
					<i class="fa-solid fa-save"></i>&nbsp; L∆∞u Thay ƒê·ªïi
				</button>
			</div>
		</div>
	</div>
    
    <!-- SCRIPT LOADING ORDER -->
    <!-- Load version and utils first as they are dependencies -->
    <script src="./js/version.js"></script>
    <script src="./js/utils.js"></script>

    <!-- Load individual modules -->
	<script src="./js/categories.js"></script>
	<script src="./js/settings.js"></script>
	<script src="./js/transactions.js"></script>
	<script src="./js/history.js"></script>
	<script src="./js/statistics.js"></script>
    <script src="js/virtual-keyboard.js"></script>
    
    <!-- Load main app logic last -->
	<script src="./js/app.js"></script>

	<script>
    // iOS Fixes and PWA initialization
	document.addEventListener('DOMContentLoaded', function() {
        // iOS specific fixes to prevent zoom on input focus
        if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
            const viewport = document.querySelector('meta[name="viewport"]');
            if (viewport) {
                // Ensure viewport meta prevents scaling
                const content = viewport.getAttribute('content');
                if (!content.includes('user-scalable=no')) {
                    viewport.setAttribute('content', content + ', user-scalable=no');
                }
            }
        }
    });

	// Service Worker registration
	if ('serviceWorker' in navigator) {
		window.addEventListener('load', function() {
            // The service worker registration logic is now handled inside app.js
            // for better coordination with the UpdateManager.
            console.log("PWA registration will be handled by app.js");
		});
	}
	</script>
	
	<style>
	/* iOS specific fixes */
	.ios-keyboard-open {
	    padding-bottom: 0 !important;
	}
	
	@media screen and (max-device-width: 896px) and (-webkit-min-device-pixel-ratio: 2) {
	    /* iPhone specific styles */
	    input[type="text"],
	    input[type="tel"],
	    input[type="number"],
	    input[type="email"],
	    input[type="datetime-local"],
	    textarea,
	    select {
	        font-size: 16px !important;
	        -webkit-appearance: none !important;
	        border-radius: 8px !important;
	    }
	    
	    /* Fix for amount input */
	    .amount-input {
	        font-size: 18px !important;
	        -webkit-user-select: text !important;
	        user-select: text !important;
	    }
	}
	</style>
</body>
</html>
