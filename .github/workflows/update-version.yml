- name: Extract and sync version
      run: |
        VERSION_FILE="js/version.js"
        UTILS_FILE="js/utils.js" # Váº«n giá»¯ Ä‘á»ƒ backup, nhÆ°ng khÃ´ng sá»­a
        MANIFEST_FILE="manifest.json"
        
        echo "ðŸ“‚ Working directory: $(pwd)"
        echo "ðŸ“‹ Files in js/:"
        ls -la js/ || echo "js/ directory not found"
        
        # Äá»c ná»™i dung file version.js
        echo "ðŸ“– Content of $VERSION_FILE:"
        cat "$VERSION_FILE"
        
        # TrÃ­ch xuáº¥t phiÃªn báº£n vá»›i nhiá»u pattern khÃ¡c nhau
        echo "ðŸ” Extracting version..."
        
        # Thá»­ pattern 1: const APP_VERSION = '1.2.3';
        NEW_VERSION=$(grep -E "const APP_VERSION = '[0-9]+\.[0-9]+\.[0-9]+'" "$VERSION_FILE" | sed -E "s/.*'([0-9]+\.[0-9]+\.[0-9]+)'.*/\1/" | head -1)
        
        # Náº¿u khÃ´ng tÃ¬m tháº¥y, thá»­ pattern 2: const APP_VERSION = "1.2.3";
        if [ -z "$NEW_VERSION" ]; then
          NEW_VERSION=$(grep -E 'const APP_VERSION = "[0-9]+\.[0-9]+\.[0-9]+"' "$VERSION_FILE" | sed -E 's/.*"([0-9]+\.[0-9]+\.[0-9]+)".*/\1/' | head -1)
        fi
        
        # Náº¿u váº«n khÃ´ng tÃ¬m tháº¥y, thá»­ pattern 3: APP_VERSION = '1.2.3'
        if [ -z "$NEW_VERSION" ]; then
          NEW_VERSION=$(grep -E "APP_VERSION = '[0-9]+\.[0-9]+\.[0-9]+'" "$VERSION_FILE" | sed -E "s/.*'([0-9]+\.[0-9]+\.[0-9]+)'.*/\1/" | head -1)
        fi
        
        if [ -z "$NEW_VERSION" ]; then
          echo "âŒ KhÃ´ng thá»ƒ trÃ­ch xuáº¥t version tá»« $VERSION_FILE"
          echo "ðŸ“‹ Ná»™i dung file:"
          cat "$VERSION_FILE"
          exit 1
        fi
        
        echo "âœ… Extracted version: $NEW_VERSION"
        
        # Backup cÃ¡c file trÆ°á»›c khi thay Ä‘á»•i
        # cp "$UTILS_FILE" "${UTILS_FILE}.backup" # KhÃ´ng cáº§n sá»­a UTILS_FILE ná»¯a, nhÆ°ng cÃ³ thá»ƒ váº«n backup cho an toÃ n náº¿u muá»‘n
        cp "$MANIFEST_FILE" "${MANIFEST_FILE}.backup"
        
        echo "ðŸ’¾ Backed up manifest.json"
        
        # Cáº­p nháº­t utils.js - Bá» qua pháº§n nÃ y
        echo "â„¹ï¸ Skipping update for $UTILS_FILE as version is handled internally by the app."
        
        # Cáº­p nháº­t manifest.json
        echo "ðŸ”§ Updating $MANIFEST_FILE..."
        
        # Sá»­ dá»¥ng jq náº¿u cÃ³
        if command -v jq &> /dev/null; then
          jq ".version = \"$NEW_VERSION\"" "$MANIFEST_FILE" > "${MANIFEST_FILE}.tmp" && mv "${MANIFEST_FILE}.tmp" "$MANIFEST_FILE"
          echo "âœ… Updated manifest.json using jq"
        else
          # Fallback vá»›i sed
          sed -i -E "s/(\"version\":[ ]*\")[0-9]+\.[0-9]+\.[0-9]+(\")/\1$NEW_VERSION\2/" "$MANIFEST_FILE"
          echo "âœ… Updated manifest.json using sed"
        fi
        
        # Kiá»ƒm tra thay Ä‘á»•i (chá»‰ kiá»ƒm tra manifest.json)
        echo "ðŸ” Checking changes..."
        
        if ! diff "$MANIFEST_FILE" "${MANIFEST_FILE}.backup" > /dev/null 2>&1; then
          echo "âœ… manifest.json has been changed"
        else
          echo "â„¹ï¸ manifest.json unchanged"
        fi
        
        # LÆ°u version vÃ o environment
        echo "NEW_VERSION=$NEW_VERSION" >> $GITHUB_ENV
